<!DOCTYPE html>
<html data-precompiled=true lang="en" data-dtinth="true">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/icon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Counters in Ruby | notes.dt.in.th</title><meta property="og:title" content="Counters in Ruby" data-source="note">
<meta property="og:image" content="https://screenshot.source.in.th/image/_/notes/RubyCounters" data-source="note">
<meta property="og:image:width" content="1800" data-source="note">
<meta property="og:image:height" content="1680" data-source="note">
<link rel="canonical" href="https://notes.dt.in.th/RubyCounters" data-source="note"><style id="note-styles">/* layer: default */
.my[data-v-8c9498c0]{margin-top:1rem;margin-bottom:1rem;}
.b[data-v-8c9498c0]{border-width:1px;}</style>
    <script
      async
      src="https://cdn.jsdelivr.net/npm/iconify-icon@2.1.0/dist/iconify-icon.min.js"
      integrity="sha256-dY2Ug42wyv3rl+sLVKEg3jbPs8f+hi7tmJ836AxVDwI="
      crossorigin="anonymous"
    ></script>
    <script
      async
      src="https://cdn.jsdelivr.net/npm/blurhash-image@1.0.1/blurhash-image.min.js"
      integrity="sha256-qrUUgTGk7xA7iVCwraHNQjwy2JryA0K4L3DL4qidagQ="
      crossorigin="anonymous"
    ></script>
    <script type="module" crossorigin src="/runtime/index.js"></script>
    <link rel="modulepreload" crossorigin href="/assets/supabase-CjkNZD6A.js">
    <link rel="stylesheet" crossorigin href="/runtime/index.css">
  </head>
  <body class="bg-#252423 text-#e9e8e7 antialiased">
    <header class="h-[58px] bg-#090807 border-b border-#454443 z-20 flex">
      <div class="flex items-center pl-[18px] flex-none">
        <a
          class="flex items-center text-#8b8685 hover:text-#ffffbb text-lg"
          href="/"
          >notes.dt.in.th</a
        >
      </div>
      <div
        class="flex-1 flex items-center text-#8b8685 [&_a:hover]:text-#ffffbb overflow-hidden"
        id="headerMiddle"
      >
        <div class="px-2 flex-none">›</div><div class="truncate"><a title="Ruby (topic)" href="Ruby">Ruby</a></div>
      </div>
      <div
        class="flex items-center px-[18px] flex-none gap-4"
        id="headerToolbar"
      ></div>
    </header>
    <div class="h-entry">
      <main class="bg-#353433" id="main">
        <div class="notes-layout-container mx-auto p-6 py-12" id="mainContents">
          <div class="prose e-content" id="noteContents"><!--[--><h1 id="counters-in-ruby" data-v-8c9498c0><a aria-hidden="true" tabindex="-1" href="#counters-in-ruby" data-v-8c9498c0><span class="icon icon-link" data-v-8c9498c0></span></a>Counters in Ruby</h1><p data-v-8c9498c0>I just read <a href="https://pontakornth.vercel.app/blog/useful-counter/" data-v-8c9498c0>↩ Pontakorn&#39;s blog</a> about the usefulness of Python&#39;s <a href="https://docs.python.org/3/library/collections.html#counter-objects" data-v-8c9498c0><code data-v-8c9498c0>collections.Counter</code></a> class. I think it is very useful, so I want to find ways to do the same thing in <a href="Ruby" data-v-8c9498c0>Ruby</a>.</p><p data-v-8c9498c0><strong data-v-8c9498c0>Ruby does not have a <code data-v-8c9498c0>Counter</code> class,</strong> but the same functionalities can be accomplished using just Ruby&#39;s built-in APIs and data structures.</p><h2 id="functional-counters" data-v-8c9498c0><a aria-hidden="true" tabindex="-1" href="#functional-counters" data-v-8c9498c0><span class="icon icon-link" data-v-8c9498c0></span></a>Functional counters</h2><h3 id="post-ruby-27" data-v-8c9498c0><a aria-hidden="true" tabindex="-1" href="#post-ruby-27" data-v-8c9498c0><span class="icon icon-link" data-v-8c9498c0></span></a>Post-Ruby 2.7</h3><p data-v-8c9498c0>Here, we have collection of data that we want to count. For example, given a string <code data-v-8c9498c0>s = &quot;abcabcabczza&quot;</code>, we want to count the occurrence of each character:</p><ol data-v-8c9498c0><li data-v-8c9498c0><p data-v-8c9498c0>Separate the string into characters^[We can skip creating an intermediate array in this step by using <code data-v-8c9498c0>.each_char</code> instead of <code data-v-8c9498c0>.chars</code>]:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> s.chars</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#=&gt; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;z&quot;, &quot;z&quot;, &quot;a&quot;]</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Use <code data-v-8c9498c0>Enumerable#tally</code>:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> s.chars.tally</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#=&gt; {&quot;a&quot;=&gt;4, &quot;b&quot;=&gt;3, &quot;c&quot;=&gt;3, &quot;z&quot;=&gt;2}</span></span></code></pre></li></ol><h3 id="pre-ruby-27" data-v-8c9498c0><a aria-hidden="true" tabindex="-1" href="#pre-ruby-27" data-v-8c9498c0><span class="icon icon-link" data-v-8c9498c0></span></a>Pre-Ruby 2.7</h3><p data-v-8c9498c0>Here, we have collection of data that we want to count. For example, given a string <code data-v-8c9498c0>s = &quot;abcabcabczza&quot;</code>, we want to count the occurrence of each character:</p><ol data-v-8c9498c0><li data-v-8c9498c0><p data-v-8c9498c0>Separate the string into characters^[We can skip creating an intermediate array in this step by using <code data-v-8c9498c0>.each_char</code> instead of <code data-v-8c9498c0>.chars</code>]:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> s.chars</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#=&gt; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;z&quot;, &quot;z&quot;, &quot;a&quot;]</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Group by itself:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> s.chars.group_by(</span><span style="color:#F97583;" data-v-8c9498c0>&amp;</span><span style="color:#79B8FF;" data-v-8c9498c0>:itself</span><span style="color:#E1E4E8;" data-v-8c9498c0>)</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#=&gt; {&quot;a&quot;=&gt;[&quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;],</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#    &quot;b&quot;=&gt;[&quot;b&quot;, &quot;b&quot;, &quot;b&quot;],</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#    &quot;c&quot;=&gt;[&quot;c&quot;, &quot;c&quot;, &quot;c&quot;],</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#    &quot;z&quot;=&gt;[&quot;z&quot;, &quot;z&quot;]}</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Transform the grouping into count:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> s.chars.group_by(</span><span style="color:#F97583;" data-v-8c9498c0>&amp;</span><span style="color:#79B8FF;" data-v-8c9498c0>:itself</span><span style="color:#E1E4E8;" data-v-8c9498c0>).transform_values(</span><span style="color:#F97583;" data-v-8c9498c0>&amp;</span><span style="color:#79B8FF;" data-v-8c9498c0>:count</span><span style="color:#E1E4E8;" data-v-8c9498c0>)</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#=&gt; {&quot;a&quot;=&gt;4, &quot;b&quot;=&gt;3, &quot;c&quot;=&gt;3, &quot;z&quot;=&gt;2}</span></span></code></pre></li></ol><h3 id="hamlet-word-counting" data-v-8c9498c0><a aria-hidden="true" tabindex="-1" href="#hamlet-word-counting" data-v-8c9498c0><span class="icon icon-link" data-v-8c9498c0></span></a>Hamlet word counting</h3><p data-v-8c9498c0>This is <a href="https://docs.python.org/3/library/collections.html#counter-objects" data-v-8c9498c0>the example from Python&#39;s docs for <code data-v-8c9498c0>Counter</code></a>^[The numbers are different because I used a different <code data-v-8c9498c0>hamlet.txt</code> than the one used in the example.]:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;&gt;&gt;</span><span style="color:#F97583;" data-v-8c9498c0> from</span><span style="color:#E1E4E8;" data-v-8c9498c0> collections </span><span style="color:#F97583;" data-v-8c9498c0>import</span><span style="color:#E1E4E8;" data-v-8c9498c0> Counter</span></span>
<span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;&gt;&gt;</span><span style="color:#F97583;" data-v-8c9498c0> import</span><span style="color:#E1E4E8;" data-v-8c9498c0> re</span></span>
<span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;&gt;&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> words </span><span style="color:#F97583;" data-v-8c9498c0>=</span><span style="color:#E1E4E8;" data-v-8c9498c0> re.findall(</span><span style="color:#F97583;" data-v-8c9498c0>r</span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;</span><span style="color:#79B8FF;" data-v-8c9498c0>\w</span><span style="color:#F97583;" data-v-8c9498c0>+</span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>, </span><span style="color:#79B8FF;" data-v-8c9498c0>open</span><span style="color:#E1E4E8;" data-v-8c9498c0>(</span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;hamlet.txt&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>).read().lower())</span></span>
<span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;&gt;&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> Counter(words).most_common(</span><span style="color:#79B8FF;" data-v-8c9498c0>10</span><span style="color:#E1E4E8;" data-v-8c9498c0>)</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0># [(&#39;the&#39;, 993), (&#39;and&#39;, 863), (&#39;to&#39;, 685), (&#39;of&#39;, 610), (&#39;i&#39;, 574),</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#  (&#39;you&#39;, 527), (&#39;a&#39;, 511), (&#39;my&#39;, 502), (&#39;it&#39;, 419), (&#39;in&#39;, 400)]</span></span></code></pre><p data-v-8c9498c0>Let&#39;s do the same in Ruby.</p><ol data-v-8c9498c0><li data-v-8c9498c0><p data-v-8c9498c0>Read the file:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#79B8FF;" data-v-8c9498c0> File</span><span style="color:#E1E4E8;" data-v-8c9498c0>.read(</span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;hamlet.txt&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>)</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#=&gt; &quot;[The Tragedie of Hamlet by William Shakespeare 1599]\n\n\nActus Primus...&quot;</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Transform to lowercase^[In <code data-v-8c9498c0>irb</code> (Interactive Ruby), the <code data-v-8c9498c0>_</code> variable corresponds to the result of the previous line.]:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> _.downcase</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#=&gt; &quot;[the tragedie of hamlet by william shakespeare 1599]\n\n\nactus primus...&quot;</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Get all the words:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> _.scan(</span><span style="color:#9ECBFF;" data-v-8c9498c0>/</span><span style="color:#85E89D;font-weight:bold;" data-v-8c9498c0>\w</span><span style="color:#DBEDFF;" data-v-8c9498c0>+</span><span style="color:#9ECBFF;" data-v-8c9498c0>/</span><span style="color:#E1E4E8;" data-v-8c9498c0>)</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#=&gt; [&quot;the&quot;, &quot;tragedie&quot;, &quot;of&quot;, &quot;hamlet&quot;, &quot;by&quot;, &quot;william&quot;, &quot;shakespeare&quot;, &quot;1599&quot;,</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#    &quot;actus&quot;, &quot;primus&quot;, &quot;scoena&quot;, &quot;prima&quot;, &quot;enter&quot;, &quot;barnardo&quot;, &quot;and&quot;, ...]</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Group by itself and get the count:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> _.group_by(</span><span style="color:#F97583;" data-v-8c9498c0>&amp;</span><span style="color:#79B8FF;" data-v-8c9498c0>:itself</span><span style="color:#E1E4E8;" data-v-8c9498c0>).transform_values(</span><span style="color:#F97583;" data-v-8c9498c0>&amp;</span><span style="color:#79B8FF;" data-v-8c9498c0>:count</span><span style="color:#E1E4E8;" data-v-8c9498c0>)</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#=&gt; {&quot;the&quot;=&gt;993, &quot;tragedie&quot;=&gt;4, &quot;of&quot;=&gt;610, &quot;hamlet&quot;=&gt;100, &quot;by&quot;=&gt;107,</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#    &quot;william&quot;=&gt;1, &quot;shakespeare&quot;=&gt;1, &quot;1599&quot;=&gt;1, &quot;actus&quot;=&gt;2, &quot;primus&quot;=&gt;1, ...}</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Sort by count^[A hash, when enumerated, each entry is represented as a <code data-v-8c9498c0>[key, value]</code> pair. So, <code data-v-8c9498c0>item.first</code> is the key and <code data-v-8c9498c0>item.last</code> is the value. Consequently, <code data-v-8c9498c0>hash.sort_by(&amp;:first)</code> means sort by key and <code data-v-8c9498c0>hash.sort_by(&amp;:last)</code> means sort by value.]:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> _.sort_by(</span><span style="color:#F97583;" data-v-8c9498c0>&amp;</span><span style="color:#79B8FF;" data-v-8c9498c0>:last</span><span style="color:#E1E4E8;" data-v-8c9498c0>)</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#=&gt; [... [&quot;his&quot;, 285], [&quot;not&quot;, 300], [&quot;is&quot;, 328], [&quot;ham&quot;, 337], [&quot;that&quot;, 377],</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#    [&quot;in&quot;, 400], [&quot;it&quot;, 419], [&quot;my&quot;, 502], [&quot;a&quot;, 511], [&quot;you&quot;, 527],</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#    [&quot;i&quot;, 574], [&quot;of&quot;, 610], [&quot;to&quot;, 685], [&quot;and&quot;, 863], [&quot;the&quot;, 993]]</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>We only need the top ten. So take the last 10 entries and reverse to get the final result:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> _.last(</span><span style="color:#79B8FF;" data-v-8c9498c0>10</span><span style="color:#E1E4E8;" data-v-8c9498c0>).reverse</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#=&gt; [[&quot;the&quot;, 993], [&quot;and&quot;, 863], [&quot;to&quot;, 685], [&quot;of&quot;, 610], [&quot;i&quot;, 574],</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#    [&quot;you&quot;, 527], [&quot;a&quot;, 511], [&quot;my&quot;, 502], [&quot;it&quot;, 419], [&quot;in&quot;, 400]]</span></span></code></pre></li></ol><p data-v-8c9498c0>Combining the previous steps into a single line program.</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#79B8FF;" data-v-8c9498c0>File</span><span style="color:#E1E4E8;" data-v-8c9498c0>.read(</span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;hamlet.txt&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>).downcase.scan(</span><span style="color:#9ECBFF;" data-v-8c9498c0>/</span><span style="color:#85E89D;font-weight:bold;" data-v-8c9498c0>\w</span><span style="color:#DBEDFF;" data-v-8c9498c0>+</span><span style="color:#9ECBFF;" data-v-8c9498c0>/</span><span style="color:#E1E4E8;" data-v-8c9498c0>).group_by(</span><span style="color:#F97583;" data-v-8c9498c0>&amp;</span><span style="color:#79B8FF;" data-v-8c9498c0>:itself</span><span style="color:#E1E4E8;" data-v-8c9498c0>).transform_values(</span><span style="color:#F97583;" data-v-8c9498c0>&amp;</span><span style="color:#79B8FF;" data-v-8c9498c0>:count</span><span style="color:#E1E4E8;" data-v-8c9498c0>).sort_by(</span><span style="color:#F97583;" data-v-8c9498c0>&amp;</span><span style="color:#79B8FF;" data-v-8c9498c0>:last</span><span style="color:#E1E4E8;" data-v-8c9498c0>).last(</span><span style="color:#79B8FF;" data-v-8c9498c0>10</span><span style="color:#E1E4E8;" data-v-8c9498c0>).reverse</span></span></code></pre><p data-v-8c9498c0>As you see, <strong data-v-8c9498c0>in Ruby many problems can be solved by writing code <a href="RubyMethodChaining" data-v-8c9498c0>strictly from left to right</a>.</strong> Meanwhile in Python, oftentimes you need to mix function calls with methods (e.g. <code data-v-8c9498c0>str.lower()</code>, <code data-v-8c9498c0>len(str)</code>) and list comprehensions.</p><h2 id="imperative-counters" data-v-8c9498c0><a aria-hidden="true" tabindex="-1" href="#imperative-counters" data-v-8c9498c0><span class="icon icon-link" data-v-8c9498c0></span></a>Imperative counters</h2><p data-v-8c9498c0>When counting <strong data-v-8c9498c0>imperatively</strong> we start from zero and tally up the counts.</p><p data-v-8c9498c0>This is <a href="https://docs.python.org/3/library/collections.html#counter-objects" data-v-8c9498c0>the example from Python&#39;s docs for <code data-v-8c9498c0>Counter</code></a>:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;&gt;&gt;</span><span style="color:#6A737D;" data-v-8c9498c0> # Tally occurrences of words in a list</span></span>
<span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;&gt;&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> cnt </span><span style="color:#F97583;" data-v-8c9498c0>=</span><span style="color:#E1E4E8;" data-v-8c9498c0> Counter()</span></span>
<span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;&gt;&gt;</span><span style="color:#F97583;" data-v-8c9498c0> for</span><span style="color:#E1E4E8;" data-v-8c9498c0> word </span><span style="color:#F97583;" data-v-8c9498c0>in</span><span style="color:#E1E4E8;" data-v-8c9498c0> [</span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;red&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>, </span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;blue&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>, </span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;red&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>, </span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;green&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>, </span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;blue&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>, </span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;blue&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>]:</span></span>
<span class="line" data-v-8c9498c0><span style="color:#79B8FF;" data-v-8c9498c0>...</span><span style="color:#E1E4E8;" data-v-8c9498c0>     cnt[word] </span><span style="color:#F97583;" data-v-8c9498c0>+=</span><span style="color:#79B8FF;" data-v-8c9498c0> 1</span></span>
<span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;&gt;&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> cnt</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0># Counter({&#39;blue&#39;: 3, &#39;red&#39;: 2, &#39;green&#39;: 1})</span></span></code></pre><p data-v-8c9498c0>In Ruby, hashes can have a <strong data-v-8c9498c0>default value</strong>. We can use a hash with a default value of 0 to simulate a counter, no specialized data structure needed:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0" data-v-8c9498c0><code data-v-8c9498c0><span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> cnt </span><span style="color:#F97583;" data-v-8c9498c0>=</span><span style="color:#79B8FF;" data-v-8c9498c0> Hash</span><span style="color:#E1E4E8;" data-v-8c9498c0>.</span><span style="color:#F97583;" data-v-8c9498c0>new</span><span style="color:#E1E4E8;" data-v-8c9498c0>(</span><span style="color:#79B8FF;" data-v-8c9498c0>0</span><span style="color:#E1E4E8;" data-v-8c9498c0>)</span></span>
<span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>*</span><span style="color:#E1E4E8;" data-v-8c9498c0> [</span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;red&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>, </span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;blue&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>, </span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;red&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>, </span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;green&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>, </span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;blue&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>, </span><span style="color:#9ECBFF;" data-v-8c9498c0>&#39;blue&#39;</span><span style="color:#E1E4E8;" data-v-8c9498c0>].each </span><span style="color:#F97583;" data-v-8c9498c0>do</span><span style="color:#E1E4E8;" data-v-8c9498c0> |word|</span></span>
<span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>*</span><span style="color:#E1E4E8;" data-v-8c9498c0>   cnt[word] </span><span style="color:#F97583;" data-v-8c9498c0>+=</span><span style="color:#79B8FF;" data-v-8c9498c0> 1</span></span>
<span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#F97583;" data-v-8c9498c0> end</span></span>
<span class="line" data-v-8c9498c0><span style="color:#F97583;" data-v-8c9498c0>&gt;</span><span style="color:#E1E4E8;" data-v-8c9498c0> cnt</span></span>
<span class="line" data-v-8c9498c0><span style="color:#6A737D;" data-v-8c9498c0>#=&gt; {&quot;red&quot;=&gt;2, &quot;blue&quot;=&gt;3, &quot;green&quot;=&gt;1}</span></span></code></pre><!--]--></div>
        </div>
      </main>
      <footer>
        <div
          class="notes-layout-container mx-auto py-4 px-6 text-#8b8685 text-right text-sm"
          id="footerContents"
        >
          <notes-page-footer></notes-page-footer>
        </div>
      </footer>
    </div>
    <script>
window.precompiledNoteBehavior = function(require, exports, module, Vue) {"use strict";Object.defineProperty(exports, "__esModule", {value: true});const __sfc__ = {};
var _vue = require('vue');

const _withScopeId = n => (_vue.pushScopeId.call(void 0, "data-v-8c9498c0"),n=n(),_vue.popScopeId.call(void 0, ),n)
const _hoisted_1 = /*#__PURE__*/_vue.createStaticVNode.call(void 0, "<h1 id=\"counters-in-ruby\" data-v-8c9498c0><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#counters-in-ruby\" data-v-8c9498c0><span class=\"icon icon-link\" data-v-8c9498c0></span></a>Counters in Ruby</h1><p data-v-8c9498c0>I just read <a href=\"https://pontakornth.vercel.app/blog/useful-counter/\" data-v-8c9498c0>↩ Pontakorn&#39;s blog</a> about the usefulness of Python&#39;s <a href=\"https://docs.python.org/3/library/collections.html#counter-objects\" data-v-8c9498c0><code data-v-8c9498c0>collections.Counter</code></a> class. I think it is very useful, so I want to find ways to do the same thing in <a href=\"Ruby\" data-v-8c9498c0>Ruby</a>.</p><p data-v-8c9498c0><strong data-v-8c9498c0>Ruby does not have a <code data-v-8c9498c0>Counter</code> class,</strong> but the same functionalities can be accomplished using just Ruby&#39;s built-in APIs and data structures.</p><h2 id=\"functional-counters\" data-v-8c9498c0><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#functional-counters\" data-v-8c9498c0><span class=\"icon icon-link\" data-v-8c9498c0></span></a>Functional counters</h2><h3 id=\"post-ruby-27\" data-v-8c9498c0><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#post-ruby-27\" data-v-8c9498c0><span class=\"icon icon-link\" data-v-8c9498c0></span></a>Post-Ruby 2.7</h3><p data-v-8c9498c0>Here, we have collection of data that we want to count. For example, given a string <code data-v-8c9498c0>s = &quot;abcabcabczza&quot;</code>, we want to count the occurrence of each character:</p><ol data-v-8c9498c0><li data-v-8c9498c0><p data-v-8c9498c0>Separate the string into characters^[We can skip creating an intermediate array in this step by using <code data-v-8c9498c0>.each_char</code> instead of <code data-v-8c9498c0>.chars</code>]:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> s.chars</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#=&gt; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;z&quot;, &quot;z&quot;, &quot;a&quot;]</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Use <code data-v-8c9498c0>Enumerable#tally</code>:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> s.chars.tally</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#=&gt; {&quot;a&quot;=&gt;4, &quot;b&quot;=&gt;3, &quot;c&quot;=&gt;3, &quot;z&quot;=&gt;2}</span></span></code></pre></li></ol><h3 id=\"pre-ruby-27\" data-v-8c9498c0><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#pre-ruby-27\" data-v-8c9498c0><span class=\"icon icon-link\" data-v-8c9498c0></span></a>Pre-Ruby 2.7</h3><p data-v-8c9498c0>Here, we have collection of data that we want to count. For example, given a string <code data-v-8c9498c0>s = &quot;abcabcabczza&quot;</code>, we want to count the occurrence of each character:</p><ol data-v-8c9498c0><li data-v-8c9498c0><p data-v-8c9498c0>Separate the string into characters^[We can skip creating an intermediate array in this step by using <code data-v-8c9498c0>.each_char</code> instead of <code data-v-8c9498c0>.chars</code>]:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> s.chars</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#=&gt; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;z&quot;, &quot;z&quot;, &quot;a&quot;]</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Group by itself:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> s.chars.group_by(</span><span style=\"color:#F97583;\" data-v-8c9498c0>&amp;</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>:itself</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>)</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#=&gt; {&quot;a&quot;=&gt;[&quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;],</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#    &quot;b&quot;=&gt;[&quot;b&quot;, &quot;b&quot;, &quot;b&quot;],</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#    &quot;c&quot;=&gt;[&quot;c&quot;, &quot;c&quot;, &quot;c&quot;],</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#    &quot;z&quot;=&gt;[&quot;z&quot;, &quot;z&quot;]}</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Transform the grouping into count:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> s.chars.group_by(</span><span style=\"color:#F97583;\" data-v-8c9498c0>&amp;</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>:itself</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>).transform_values(</span><span style=\"color:#F97583;\" data-v-8c9498c0>&amp;</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>:count</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>)</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#=&gt; {&quot;a&quot;=&gt;4, &quot;b&quot;=&gt;3, &quot;c&quot;=&gt;3, &quot;z&quot;=&gt;2}</span></span></code></pre></li></ol><h3 id=\"hamlet-word-counting\" data-v-8c9498c0><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#hamlet-word-counting\" data-v-8c9498c0><span class=\"icon icon-link\" data-v-8c9498c0></span></a>Hamlet word counting</h3><p data-v-8c9498c0>This is <a href=\"https://docs.python.org/3/library/collections.html#counter-objects\" data-v-8c9498c0>the example from Python&#39;s docs for <code data-v-8c9498c0>Counter</code></a>^[The numbers are different because I used a different <code data-v-8c9498c0>hamlet.txt</code> than the one used in the example.]:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;&gt;&gt;</span><span style=\"color:#F97583;\" data-v-8c9498c0> from</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> collections </span><span style=\"color:#F97583;\" data-v-8c9498c0>import</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> Counter</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;&gt;&gt;</span><span style=\"color:#F97583;\" data-v-8c9498c0> import</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> re</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;&gt;&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> words </span><span style=\"color:#F97583;\" data-v-8c9498c0>=</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> re.findall(</span><span style=\"color:#F97583;\" data-v-8c9498c0>r</span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>\\w</span><span style=\"color:#F97583;\" data-v-8c9498c0>+</span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>, </span><span style=\"color:#79B8FF;\" data-v-8c9498c0>open</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>(</span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;hamlet.txt&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>).read().lower())</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;&gt;&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> Counter(words).most_common(</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>10</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>)</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0># [(&#39;the&#39;, 993), (&#39;and&#39;, 863), (&#39;to&#39;, 685), (&#39;of&#39;, 610), (&#39;i&#39;, 574),</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#  (&#39;you&#39;, 527), (&#39;a&#39;, 511), (&#39;my&#39;, 502), (&#39;it&#39;, 419), (&#39;in&#39;, 400)]</span></span></code></pre><p data-v-8c9498c0>Let&#39;s do the same in Ruby.</p><ol data-v-8c9498c0><li data-v-8c9498c0><p data-v-8c9498c0>Read the file:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#79B8FF;\" data-v-8c9498c0> File</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>.read(</span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;hamlet.txt&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>)</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#=&gt; &quot;[The Tragedie of Hamlet by William Shakespeare 1599]\\n\\n\\nActus Primus...&quot;</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Transform to lowercase^[In <code data-v-8c9498c0>irb</code> (Interactive Ruby), the <code data-v-8c9498c0>_</code> variable corresponds to the result of the previous line.]:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> _.downcase</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#=&gt; &quot;[the tragedie of hamlet by william shakespeare 1599]\\n\\n\\nactus primus...&quot;</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Get all the words:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> _.scan(</span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>/</span><span style=\"color:#85E89D;font-weight:bold;\" data-v-8c9498c0>\\w</span><span style=\"color:#DBEDFF;\" data-v-8c9498c0>+</span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>/</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>)</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#=&gt; [&quot;the&quot;, &quot;tragedie&quot;, &quot;of&quot;, &quot;hamlet&quot;, &quot;by&quot;, &quot;william&quot;, &quot;shakespeare&quot;, &quot;1599&quot;,</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#    &quot;actus&quot;, &quot;primus&quot;, &quot;scoena&quot;, &quot;prima&quot;, &quot;enter&quot;, &quot;barnardo&quot;, &quot;and&quot;, ...]</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Group by itself and get the count:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> _.group_by(</span><span style=\"color:#F97583;\" data-v-8c9498c0>&amp;</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>:itself</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>).transform_values(</span><span style=\"color:#F97583;\" data-v-8c9498c0>&amp;</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>:count</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>)</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#=&gt; {&quot;the&quot;=&gt;993, &quot;tragedie&quot;=&gt;4, &quot;of&quot;=&gt;610, &quot;hamlet&quot;=&gt;100, &quot;by&quot;=&gt;107,</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#    &quot;william&quot;=&gt;1, &quot;shakespeare&quot;=&gt;1, &quot;1599&quot;=&gt;1, &quot;actus&quot;=&gt;2, &quot;primus&quot;=&gt;1, ...}</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>Sort by count^[A hash, when enumerated, each entry is represented as a <code data-v-8c9498c0>[key, value]</code> pair. So, <code data-v-8c9498c0>item.first</code> is the key and <code data-v-8c9498c0>item.last</code> is the value. Consequently, <code data-v-8c9498c0>hash.sort_by(&amp;:first)</code> means sort by key and <code data-v-8c9498c0>hash.sort_by(&amp;:last)</code> means sort by value.]:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> _.sort_by(</span><span style=\"color:#F97583;\" data-v-8c9498c0>&amp;</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>:last</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>)</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#=&gt; [... [&quot;his&quot;, 285], [&quot;not&quot;, 300], [&quot;is&quot;, 328], [&quot;ham&quot;, 337], [&quot;that&quot;, 377],</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#    [&quot;in&quot;, 400], [&quot;it&quot;, 419], [&quot;my&quot;, 502], [&quot;a&quot;, 511], [&quot;you&quot;, 527],</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#    [&quot;i&quot;, 574], [&quot;of&quot;, 610], [&quot;to&quot;, 685], [&quot;and&quot;, 863], [&quot;the&quot;, 993]]</span></span></code></pre></li><li data-v-8c9498c0><p data-v-8c9498c0>We only need the top ten. So take the last 10 entries and reverse to get the final result:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> _.last(</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>10</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>).reverse</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#=&gt; [[&quot;the&quot;, 993], [&quot;and&quot;, 863], [&quot;to&quot;, 685], [&quot;of&quot;, 610], [&quot;i&quot;, 574],</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#    [&quot;you&quot;, 527], [&quot;a&quot;, 511], [&quot;my&quot;, 502], [&quot;it&quot;, 419], [&quot;in&quot;, 400]]</span></span></code></pre></li></ol><p data-v-8c9498c0>Combining the previous steps into a single line program.</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#79B8FF;\" data-v-8c9498c0>File</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>.read(</span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;hamlet.txt&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>).downcase.scan(</span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>/</span><span style=\"color:#85E89D;font-weight:bold;\" data-v-8c9498c0>\\w</span><span style=\"color:#DBEDFF;\" data-v-8c9498c0>+</span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>/</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>).group_by(</span><span style=\"color:#F97583;\" data-v-8c9498c0>&amp;</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>:itself</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>).transform_values(</span><span style=\"color:#F97583;\" data-v-8c9498c0>&amp;</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>:count</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>).sort_by(</span><span style=\"color:#F97583;\" data-v-8c9498c0>&amp;</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>:last</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>).last(</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>10</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>).reverse</span></span></code></pre><p data-v-8c9498c0>As you see, <strong data-v-8c9498c0>in Ruby many problems can be solved by writing code <a href=\"RubyMethodChaining\" data-v-8c9498c0>strictly from left to right</a>.</strong> Meanwhile in Python, oftentimes you need to mix function calls with methods (e.g. <code data-v-8c9498c0>str.lower()</code>, <code data-v-8c9498c0>len(str)</code>) and list comprehensions.</p><h2 id=\"imperative-counters\" data-v-8c9498c0><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#imperative-counters\" data-v-8c9498c0><span class=\"icon icon-link\" data-v-8c9498c0></span></a>Imperative counters</h2><p data-v-8c9498c0>When counting <strong data-v-8c9498c0>imperatively</strong> we start from zero and tally up the counts.</p><p data-v-8c9498c0>This is <a href=\"https://docs.python.org/3/library/collections.html#counter-objects\" data-v-8c9498c0>the example from Python&#39;s docs for <code data-v-8c9498c0>Counter</code></a>:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;&gt;&gt;</span><span style=\"color:#6A737D;\" data-v-8c9498c0> # Tally occurrences of words in a list</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;&gt;&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> cnt </span><span style=\"color:#F97583;\" data-v-8c9498c0>=</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> Counter()</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;&gt;&gt;</span><span style=\"color:#F97583;\" data-v-8c9498c0> for</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> word </span><span style=\"color:#F97583;\" data-v-8c9498c0>in</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> [</span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;red&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>, </span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;blue&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>, </span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;red&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>, </span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;green&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>, </span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;blue&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>, </span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;blue&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>]:</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#79B8FF;\" data-v-8c9498c0>...</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>     cnt[word] </span><span style=\"color:#F97583;\" data-v-8c9498c0>+=</span><span style=\"color:#79B8FF;\" data-v-8c9498c0> 1</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;&gt;&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> cnt</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0># Counter({&#39;blue&#39;: 3, &#39;red&#39;: 2, &#39;green&#39;: 1})</span></span></code></pre><p data-v-8c9498c0>In Ruby, hashes can have a <strong data-v-8c9498c0>default value</strong>. We can use a hash with a default value of 0 to simulate a counter, no specialized data structure needed:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\" data-v-8c9498c0><code data-v-8c9498c0><span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> cnt </span><span style=\"color:#F97583;\" data-v-8c9498c0>=</span><span style=\"color:#79B8FF;\" data-v-8c9498c0> Hash</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>.</span><span style=\"color:#F97583;\" data-v-8c9498c0>new</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>(</span><span style=\"color:#79B8FF;\" data-v-8c9498c0>0</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>)</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>*</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> [</span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;red&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>, </span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;blue&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>, </span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;red&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>, </span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;green&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>, </span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;blue&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>, </span><span style=\"color:#9ECBFF;\" data-v-8c9498c0>&#39;blue&#39;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>].each </span><span style=\"color:#F97583;\" data-v-8c9498c0>do</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> |word|</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>*</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0>   cnt[word] </span><span style=\"color:#F97583;\" data-v-8c9498c0>+=</span><span style=\"color:#79B8FF;\" data-v-8c9498c0> 1</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#F97583;\" data-v-8c9498c0> end</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#F97583;\" data-v-8c9498c0>&gt;</span><span style=\"color:#E1E4E8;\" data-v-8c9498c0> cnt</span></span>\n<span class=\"line\" data-v-8c9498c0><span style=\"color:#6A737D;\" data-v-8c9498c0>#=&gt; {&quot;red&quot;=&gt;2, &quot;blue&quot;=&gt;3, &quot;green&quot;=&gt;1}</span></span></code></pre>", 24)
function render(_ctx, _cache) {
  return _hoisted_1
}
__sfc__.render = render
__sfc__.__scopeId = "data-v-8c9498c0"
__sfc__.__file = "Note.vue"
exports. default = __sfc__};
window.precompiledFrontMatter = {"public":true,"title":"Counters in Ruby","facebook":"https://www.facebook.com/dtinth/posts/10215988562141070","aliases":["20201222T145634Z3177"]};
</script>
  </body>
</html>

<!DOCTYPE html>
<html data-precompiled=true lang="en" data-dtinth="true">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/icon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notes about React 18 RC.0 | notes.dt.in.th</title><meta property="og:title" content="Notes about React 18 RC.0" data-source="note">
<meta property="og:image" content="https://screenshot.source.in.th/image/_/notes/React18RC" data-source="note">
<meta property="og:image:width" content="1800" data-source="note">
<meta property="og:image:height" content="1680" data-source="note">
<link rel="canonical" href="https://notes.dt.in.th/React18RC" data-source="note">
    <script
      async
      src="https://cdn.jsdelivr.net/npm/iconify-icon@2.1.0/dist/iconify-icon.min.js"
      integrity="sha256-dY2Ug42wyv3rl+sLVKEg3jbPs8f+hi7tmJ836AxVDwI="
      crossorigin="anonymous"
    ></script>
    <script
      async
      src="https://cdn.jsdelivr.net/npm/blurhash-image@1.0.1/blurhash-image.min.js"
      integrity="sha256-qrUUgTGk7xA7iVCwraHNQjwy2JryA0K4L3DL4qidagQ="
      crossorigin="anonymous"
    ></script>
    <script type="module" crossorigin src="/runtime/index.js"></script>
    <link rel="modulepreload" crossorigin href="/assets/supabase-CjkNZD6A.js">
    <link rel="stylesheet" crossorigin href="/runtime/index.css">
  </head>
  <body class="bg-#252423 text-#e9e8e7 antialiased">
    <header class="h-[58px] bg-#090807 border-b border-#454443 z-20 flex">
      <div class="flex items-center pl-[18px] flex-none">
        <a
          class="flex items-center text-#8b8685 hover:text-#ffffbb text-lg"
          href="/"
          >notes.dt.in.th</a
        >
      </div>
      <div
        class="flex-1 flex items-center text-#8b8685 [&_a:hover]:text-#ffffbb overflow-hidden"
        id="headerMiddle"
      >
        <div class="px-2 flex-none">›</div><div class="truncate"><a title="Cloud Platform (topic)" href="CloudPlatform">Cloud Platform</a></div><div class="px-2 flex-none">›</div><div class="truncate"><a title="Vercel (topic)" href="Vercel">Vercel</a></div><div class="px-2 flex-none">›</div><div class="truncate"><a title="Next.js (topic)" href="Next">Next.js</a></div><div class="px-2 flex-none">›</div><div class="truncate"><a title="React (topic)" href="React">React</a></div>
      </div>
      <div
        class="flex items-center px-[18px] flex-none gap-4"
        id="headerToolbar"
      ></div>
    </header>
    <div class="h-entry">
      <main class="bg-#353433" id="main">
        <div class="notes-layout-container mx-auto p-6 py-12" id="mainContents">
          <div class="prose e-content" id="noteContents"><!--[--><h1 id="notes-about-react-18-rc0"><a aria-hidden="true" tabindex="-1" href="#notes-about-react-18-rc0"><span class="icon icon-link"></span></a>Notes about React 18 RC.0</h1><p>I am writing this note while <a href="React">React</a> 18 is in <strong>release candidate</strong> stage. I created this note because I did not closely follow its development progress, and I’m only aware that React 18 will be released soon after the RC was published.</p><p>I studied React’s <a href="https://twitter.com/dan_abramov/status/1470613745315594247">excellent</a> test suite and <a href="https://github.com/dtinth/react-tests/blob/main/reports/v17.0.2_VS_v18.0.0-rc.0.md">compared test reports between React 17 and 18-rc.0</a>^[The <strong>bold text</strong> in front of each entry is an internal name in React source code that you can use to learn more about the feature or change, until official documentation is available. My recomendation is to look up test files with that name, as they very precisely describe the behavior of the API.] and gathered what I learned from the tests, <a href="https://reactjs.org/blog/2021/06/08/the-plan-for-react-18.html">relevant blog posts and discussions</a>^[At the time of writing, I wasn’t aware that <a href="https://conf.reactjs.org/stage">React Conf 2021</a> happened, and that React 18 RC was released during the conference. Maybe you can go watch the keynotes instead…] in this note.</p><ol><li><p><strong>ReactDOMRoot:</strong> <a href="https://github.com/reactwg/react-18/discussions/5"><code>ReactDOM.createRoot</code> supersedes <code>ReactDOM.render</code>.</a></p><ul><li><p><code>ReactDOM.render</code> is still available but this creates a “root” in <a href="https://github.com/reactwg/react-18/discussions/5#:~:text=New%20Root%20API.-,Legacy%20root%20API,-%3A%20This%20is%20the"><strong>“legacy” mode</strong></a>. This API is called “Legacy root API”. A legacy root behaves like React 17.</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// Before (Legacy Root API)</span></span>
<span class="line"><span style="color:#E1E4E8;">ReactDOM.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">(&lt;</span><span style="color:#79B8FF;">App</span><span style="color:#B392F0;"> tab</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;home&quot;</span><span style="color:#E1E4E8;"> /&gt;, container)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// After (New Root API)</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> root</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> ReactDOM.</span><span style="color:#B392F0;">createRoot</span><span style="color:#E1E4E8;">(container)</span></span>
<span class="line"><span style="color:#E1E4E8;">root.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">(&lt;</span><span style="color:#79B8FF;">App</span><span style="color:#B392F0;"> tab</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;home&quot;</span><span style="color:#E1E4E8;"> /&gt;)</span></span></code></pre></li><li><p>The new API is called the <strong>New root API</strong>. The new root API enables concurrent rendering.</p></li><li><p><a href="https://github.com/reactwg/react-18/discussions/5#:~:text=What%20about%20the%20render%20callback">This new API no longer has the ability to specify a render callback.</a> Instead, put a <code>ref</code> callback on the target DOM node to be notified when something is mounted.</p><ul><li>Due to concurrent rendering, the <code>ref</code> may not be assigned immediately (i.e. synchronously), unless <code>ReactDOM.flushSync</code> is used.</li></ul></li></ul></li><li><p><strong>ReactDOMRoot:</strong> <a href="https://github.com/reactwg/react-18/discussions/5#:~:text=What%20about%20hydration%3F"><code>ReactDOM.hydrateRoot</code> supersedes <code>ReactDOM.hydrate</code>.</a></p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// Before</span></span>
<span class="line"><span style="color:#E1E4E8;">ReactDOM.</span><span style="color:#B392F0;">hydrate</span><span style="color:#E1E4E8;">(&lt;</span><span style="color:#79B8FF;">App</span><span style="color:#B392F0;"> tab</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;home&quot;</span><span style="color:#E1E4E8;"> /&gt;, container)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// After</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> root</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> ReactDOM.</span><span style="color:#B392F0;">hydrateRoot</span><span style="color:#E1E4E8;">(container, &lt;</span><span style="color:#79B8FF;">App</span><span style="color:#B392F0;"> tab</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;home&quot;</span><span style="color:#E1E4E8;"> /&gt;)</span></span></code></pre></li><li><p><strong>ReactDOMFiberAsync:</strong> In the New root API, <a href="https://github.com/reactwg/react-18/discussions/21">state updates will be batched by default</a>.</p></li><li><p><strong>ReactFlushSync:</strong> <a href="https://github.com/reactwg/react-18/discussions/21#:~:text=What%20if%20I%20don%E2%80%99t%20want%20to%20batch%3F"><code>ReactDOM.flushSync</code></a> takes a callback that updates React state. It invokes the callback, performs the update, and flushes them to DOM <strong>synchronously</strong>. Replaces <a href="https://github.com/reactwg/react-18/discussions/21#:~:text=What%20about%20unstable_batchedUpdates"><code>unstable_batchedUpdates</code></a>.</p><ul><li>When used in conjection with <code>React.startTransition</code> (see below) then <a href="https://github.com/facebook/react/blob/f2a59df48bec2352a4dd3b5415282a4ea240a4f8/packages/react-reconciler/src/__tests__/ReactFlushSync-test.js#L70">the innermost one wins</a>.</li></ul></li><li><p><strong>ReactTransition:</strong> <a href="https://github.com/reactwg/react-18/discussions/41"><code>React.startTransition</code></a> takes a callback that updates React state and updates it with lower priority (they call it <strong>non-urgent</strong> updates). <a href="https://github.com/reactwg/react-18/discussions/65">See a real world example.</a> <a href="https://github.com/facebook/react/blob/f2a59df48bec2352a4dd3b5415282a4ea240a4f8/packages/react-reconciler/src/__tests__/ReactHooksWithNoopRenderer-test.js#L3577">See tests.</a></p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0"><code><span class="line"><span style="color:#B392F0;">setInputValue</span><span style="color:#E1E4E8;">(input) </span><span style="color:#6A737D;">// urgent (default priority)</span></span>
<span class="line"><span style="color:#B392F0;">startTransition</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  setSearchQuery</span><span style="color:#E1E4E8;">(input) </span><span style="color:#6A737D;">// non-urgent (idle priority)</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><ul><li><p><strong>ReactHooks:</strong> <a href="https://github.com/facebook/react/blob/f2a59df48bec2352a4dd3b5415282a4ea240a4f8/packages/react-reconciler/src/__tests__/ReactHooksWithNoopRenderer-test.js#L3638"><code>React.useDeferredValue</code></a> is (roughly) a <a href="https://github.dev/facebook/react/blob/3b3daf5573efe801fa3dc659020625b4023d3a9f/packages/react-reconciler/src/ReactFiberHooks.new.js#L1927">sugar for this pattern</a> (note: <a href="https://www.reddit.com/r/reactjs/comments/scz8rs/comment/huaqcor/?utm_source=reddit&amp;utm_medium=web2x&amp;context=3">might be inaccurate</a>):</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// Before</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">searchQuery</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">setSearchQuery</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> useState</span><span style="color:#E1E4E8;">(input)</span></span>
<span class="line"><span style="color:#B392F0;">useEffect</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  startTransition</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    setSearchQuery</span><span style="color:#E1E4E8;">(input)</span></span>
<span class="line"><span style="color:#E1E4E8;">  })</span></span>
<span class="line"><span style="color:#E1E4E8;">}, [input])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// After</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> searchQuery</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> useDeferredValue</span><span style="color:#E1E4E8;">(input)</span></span></code></pre></li></ul></li><li><p><strong>ReactTransition:</strong> <a href="https://github.com/reactwg/react-18/discussions/41#:~:text=What%20do%20I%20do%20while%20the%20transition%20is%20pending%3F"><code>React.useTransition</code></a> exposes an <code>isPending</code> status for transitions that are started using the returned <code>startTransition</code> callback. This allows the UI to display feedback to the user that the UI is still updating.</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">isPending</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">startTransition</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> useTransition</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#6A737D;">// Use the returned `startTransition` instead of React.startTransition.</span></span></code></pre></li><li><p><strong>ReactDOMUseId:</strong> <a href="https://github.com/reactwg/react-18/discussions/111"><code>React.useId()</code></a> generates an ID that remains consistent between server and client rendering.</p></li><li><p><strong>ReactEmptyComponent:</strong> <a href="https://github.com/reactwg/react-18/discussions/75">Components may now return <code>undefined</code> in addition to <code>null</code></a>.</p></li><li><p><strong>ReactDOMFizzServer:</strong> ^[<a href="https://www.reddit.com/r/reactjs/comments/a495zg/react_fizz_new_streaming_server_renderer/">“React Fizz”</a> is the codename for new server-rendering architecture, which supports streaming and suspense.] <a href="https://github.com/facebook/react/pull/21488"><code>React.Suspense</code> can now be rendered on the server</a>.</p><ul><li><strong>ReactDOMServerSuspense:</strong> When rendering synchronously (e.g. <code>ReactDOMServer.renderToString</code>) this <a href="https://github.com/facebook/react/blob/f2a59df48bec2352a4dd3b5415282a4ea240a4f8/packages/react-dom/src/__tests__/ReactDOMServerSuspense-test.internal.js#L111">will just render a fallback</a>.</li></ul></li><li><p><strong><a href="20220126T112639Z7327">StrictEffectsMode</a>:</strong> Under the New Root API, inside <code>&lt;React.StrictMode&gt;</code>, <code>useEffect</code> and <code>useLayoutEffects</code> callbacks are <a href="https://github.com/facebook/react/pull/21597/files">now</a> <a href="https://github.com/facebook/react/pull/19523">doubled</a> in dev mode (<a href="https://github.com/facebook/react/blob/f2a59df48bec2352a4dd3b5415282a4ea240a4f8/packages/react-reconciler/src/__tests__/StrictEffectsMode-test.js#L61">see tests</a>). That is, given the following code, it will call <code>subscribe(); unsubscribe(); subscribe()</code>:</p><pre class="shiki github-dark" style="background-color:#252423;color:#e1e4e8;" tabindex="0"><code><span class="line"><span style="color:#B392F0;">useEffect</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  subscribe</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> unsubscribe</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">}, [])</span></span></code></pre></li><li><p><strong>useSyncExternalStore:</strong> <a href="https://github.com/reactwg/react-18/discussions/86"><code>state = useSyncExternalStore(subscribe, get)</code></a> is introduced to allow components <a href="https://github.com/reactjs/rfcs/blob/main/text/0147-use-mutable-source.md">“to safely and efficiently read from a mutable external source”</a> in a way that works with concurrent rendering. For older React versions that support hooks, <a href="https://www.npmjs.com/package/use-sync-external-store"><code>use-sync-external-store/shim</code></a> package can be used. <a href="https://github.com/facebook/react/blob/f2a59df48bec2352a4dd3b5415282a4ea240a4f8/packages/use-sync-external-store/src/__tests__/useSyncExternalStoreShared-test.js#L127">See tests</a>.</p></li><li><p><strong>ReactHooks:</strong> <a href="https://github.com/reactwg/react-18/discussions/110"><code>useInsertionEffect</code> is for performing effects <em>before</em> <code>useLayoutEffect</code></a>, e.g. injecting style tags performantly in CSS-in-JS scenario when React is rendering concurrently.</p></li></ol><!--]--></div>
        </div>
      </main>
      <footer>
        <div
          class="notes-layout-container mx-auto py-4 px-6 text-#8b8685 text-right text-sm"
          id="footerContents"
        >
          <notes-page-footer></notes-page-footer>
        </div>
      </footer>
    </div>
    <script>
window.precompiledNoteBehavior = function(require, exports, module, Vue) {"use strict";Object.defineProperty(exports, "__esModule", {value: true});const __sfc__ = {};
var _vue = require('vue');

const _hoisted_1 = /*#__PURE__*/_vue.createStaticVNode.call(void 0, "<h1 id=\"notes-about-react-18-rc0\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#notes-about-react-18-rc0\"><span class=\"icon icon-link\"></span></a>Notes about React 18 RC.0</h1><p>I am writing this note while <a href=\"React\">React</a> 18 is in <strong>release candidate</strong> stage. I created this note because I did not closely follow its development progress, and I’m only aware that React 18 will be released soon after the RC was published.</p><p>I studied React’s <a href=\"https://twitter.com/dan_abramov/status/1470613745315594247\">excellent</a> test suite and <a href=\"https://github.com/dtinth/react-tests/blob/main/reports/v17.0.2_VS_v18.0.0-rc.0.md\">compared test reports between React 17 and 18-rc.0</a>^[The <strong>bold text</strong> in front of each entry is an internal name in React source code that you can use to learn more about the feature or change, until official documentation is available. My recomendation is to look up test files with that name, as they very precisely describe the behavior of the API.] and gathered what I learned from the tests, <a href=\"https://reactjs.org/blog/2021/06/08/the-plan-for-react-18.html\">relevant blog posts and discussions</a>^[At the time of writing, I wasn’t aware that <a href=\"https://conf.reactjs.org/stage\">React Conf 2021</a> happened, and that React 18 RC was released during the conference. Maybe you can go watch the keynotes instead…] in this note.</p><ol><li><p><strong>ReactDOMRoot:</strong> <a href=\"https://github.com/reactwg/react-18/discussions/5\"><code>ReactDOM.createRoot</code> supersedes <code>ReactDOM.render</code>.</a></p><ul><li><p><code>ReactDOM.render</code> is still available but this creates a “root” in <a href=\"https://github.com/reactwg/react-18/discussions/5#:~:text=New%20Root%20API.-,Legacy%20root%20API,-%3A%20This%20is%20the\"><strong>“legacy” mode</strong></a>. This API is called “Legacy root API”. A legacy root behaves like React 17.</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D;\">// Before (Legacy Root API)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8;\">ReactDOM.</span><span style=\"color:#B392F0;\">render</span><span style=\"color:#E1E4E8;\">(&lt;</span><span style=\"color:#79B8FF;\">App</span><span style=\"color:#B392F0;\"> tab</span><span style=\"color:#F97583;\">=</span><span style=\"color:#9ECBFF;\">&quot;home&quot;</span><span style=\"color:#E1E4E8;\"> /&gt;, container)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D;\">// After (New Root API)</span></span>\n<span class=\"line\"><span style=\"color:#F97583;\">const</span><span style=\"color:#79B8FF;\"> root</span><span style=\"color:#F97583;\"> =</span><span style=\"color:#E1E4E8;\"> ReactDOM.</span><span style=\"color:#B392F0;\">createRoot</span><span style=\"color:#E1E4E8;\">(container)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8;\">root.</span><span style=\"color:#B392F0;\">render</span><span style=\"color:#E1E4E8;\">(&lt;</span><span style=\"color:#79B8FF;\">App</span><span style=\"color:#B392F0;\"> tab</span><span style=\"color:#F97583;\">=</span><span style=\"color:#9ECBFF;\">&quot;home&quot;</span><span style=\"color:#E1E4E8;\"> /&gt;)</span></span></code></pre></li><li><p>The new API is called the <strong>New root API</strong>. The new root API enables concurrent rendering.</p></li><li><p><a href=\"https://github.com/reactwg/react-18/discussions/5#:~:text=What%20about%20the%20render%20callback\">This new API no longer has the ability to specify a render callback.</a> Instead, put a <code>ref</code> callback on the target DOM node to be notified when something is mounted.</p><ul><li>Due to concurrent rendering, the <code>ref</code> may not be assigned immediately (i.e. synchronously), unless <code>ReactDOM.flushSync</code> is used.</li></ul></li></ul></li><li><p><strong>ReactDOMRoot:</strong> <a href=\"https://github.com/reactwg/react-18/discussions/5#:~:text=What%20about%20hydration%3F\"><code>ReactDOM.hydrateRoot</code> supersedes <code>ReactDOM.hydrate</code>.</a></p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D;\">// Before</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8;\">ReactDOM.</span><span style=\"color:#B392F0;\">hydrate</span><span style=\"color:#E1E4E8;\">(&lt;</span><span style=\"color:#79B8FF;\">App</span><span style=\"color:#B392F0;\"> tab</span><span style=\"color:#F97583;\">=</span><span style=\"color:#9ECBFF;\">&quot;home&quot;</span><span style=\"color:#E1E4E8;\"> /&gt;, container)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D;\">// After</span></span>\n<span class=\"line\"><span style=\"color:#F97583;\">const</span><span style=\"color:#79B8FF;\"> root</span><span style=\"color:#F97583;\"> =</span><span style=\"color:#E1E4E8;\"> ReactDOM.</span><span style=\"color:#B392F0;\">hydrateRoot</span><span style=\"color:#E1E4E8;\">(container, &lt;</span><span style=\"color:#79B8FF;\">App</span><span style=\"color:#B392F0;\"> tab</span><span style=\"color:#F97583;\">=</span><span style=\"color:#9ECBFF;\">&quot;home&quot;</span><span style=\"color:#E1E4E8;\"> /&gt;)</span></span></code></pre></li><li><p><strong>ReactDOMFiberAsync:</strong> In the New root API, <a href=\"https://github.com/reactwg/react-18/discussions/21\">state updates will be batched by default</a>.</p></li><li><p><strong>ReactFlushSync:</strong> <a href=\"https://github.com/reactwg/react-18/discussions/21#:~:text=What%20if%20I%20don%E2%80%99t%20want%20to%20batch%3F\"><code>ReactDOM.flushSync</code></a> takes a callback that updates React state. It invokes the callback, performs the update, and flushes them to DOM <strong>synchronously</strong>. Replaces <a href=\"https://github.com/reactwg/react-18/discussions/21#:~:text=What%20about%20unstable_batchedUpdates\"><code>unstable_batchedUpdates</code></a>.</p><ul><li>When used in conjection with <code>React.startTransition</code> (see below) then <a href=\"https://github.com/facebook/react/blob/f2a59df48bec2352a4dd3b5415282a4ea240a4f8/packages/react-reconciler/src/__tests__/ReactFlushSync-test.js#L70\">the innermost one wins</a>.</li></ul></li><li><p><strong>ReactTransition:</strong> <a href=\"https://github.com/reactwg/react-18/discussions/41\"><code>React.startTransition</code></a> takes a callback that updates React state and updates it with lower priority (they call it <strong>non-urgent</strong> updates). <a href=\"https://github.com/reactwg/react-18/discussions/65\">See a real world example.</a> <a href=\"https://github.com/facebook/react/blob/f2a59df48bec2352a4dd3b5415282a4ea240a4f8/packages/react-reconciler/src/__tests__/ReactHooksWithNoopRenderer-test.js#L3577\">See tests.</a></p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0;\">setInputValue</span><span style=\"color:#E1E4E8;\">(input) </span><span style=\"color:#6A737D;\">// urgent (default priority)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0;\">startTransition</span><span style=\"color:#E1E4E8;\">(() </span><span style=\"color:#F97583;\">=&gt;</span><span style=\"color:#E1E4E8;\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0;\">  setSearchQuery</span><span style=\"color:#E1E4E8;\">(input) </span><span style=\"color:#6A737D;\">// non-urgent (idle priority)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8;\">})</span></span></code></pre><ul><li><p><strong>ReactHooks:</strong> <a href=\"https://github.com/facebook/react/blob/f2a59df48bec2352a4dd3b5415282a4ea240a4f8/packages/react-reconciler/src/__tests__/ReactHooksWithNoopRenderer-test.js#L3638\"><code>React.useDeferredValue</code></a> is (roughly) a <a href=\"https://github.dev/facebook/react/blob/3b3daf5573efe801fa3dc659020625b4023d3a9f/packages/react-reconciler/src/ReactFiberHooks.new.js#L1927\">sugar for this pattern</a> (note: <a href=\"https://www.reddit.com/r/reactjs/comments/scz8rs/comment/huaqcor/?utm_source=reddit&amp;utm_medium=web2x&amp;context=3\">might be inaccurate</a>):</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D;\">// Before</span></span>\n<span class=\"line\"><span style=\"color:#F97583;\">const</span><span style=\"color:#E1E4E8;\"> [</span><span style=\"color:#79B8FF;\">searchQuery</span><span style=\"color:#E1E4E8;\">, </span><span style=\"color:#79B8FF;\">setSearchQuery</span><span style=\"color:#E1E4E8;\">] </span><span style=\"color:#F97583;\">=</span><span style=\"color:#B392F0;\"> useState</span><span style=\"color:#E1E4E8;\">(input)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0;\">useEffect</span><span style=\"color:#E1E4E8;\">(() </span><span style=\"color:#F97583;\">=&gt;</span><span style=\"color:#E1E4E8;\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0;\">  startTransition</span><span style=\"color:#E1E4E8;\">(() </span><span style=\"color:#F97583;\">=&gt;</span><span style=\"color:#E1E4E8;\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0;\">    setSearchQuery</span><span style=\"color:#E1E4E8;\">(input)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8;\">  })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8;\">}, [input])</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D;\">// After</span></span>\n<span class=\"line\"><span style=\"color:#F97583;\">const</span><span style=\"color:#79B8FF;\"> searchQuery</span><span style=\"color:#F97583;\"> =</span><span style=\"color:#B392F0;\"> useDeferredValue</span><span style=\"color:#E1E4E8;\">(input)</span></span></code></pre></li></ul></li><li><p><strong>ReactTransition:</strong> <a href=\"https://github.com/reactwg/react-18/discussions/41#:~:text=What%20do%20I%20do%20while%20the%20transition%20is%20pending%3F\"><code>React.useTransition</code></a> exposes an <code>isPending</code> status for transitions that are started using the returned <code>startTransition</code> callback. This allows the UI to display feedback to the user that the UI is still updating.</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583;\">const</span><span style=\"color:#E1E4E8;\"> [</span><span style=\"color:#79B8FF;\">isPending</span><span style=\"color:#E1E4E8;\">, </span><span style=\"color:#79B8FF;\">startTransition</span><span style=\"color:#E1E4E8;\">] </span><span style=\"color:#F97583;\">=</span><span style=\"color:#B392F0;\"> useTransition</span><span style=\"color:#E1E4E8;\">()</span></span>\n<span class=\"line\"><span style=\"color:#6A737D;\">// Use the returned `startTransition` instead of React.startTransition.</span></span></code></pre></li><li><p><strong>ReactDOMUseId:</strong> <a href=\"https://github.com/reactwg/react-18/discussions/111\"><code>React.useId()</code></a> generates an ID that remains consistent between server and client rendering.</p></li><li><p><strong>ReactEmptyComponent:</strong> <a href=\"https://github.com/reactwg/react-18/discussions/75\">Components may now return <code>undefined</code> in addition to <code>null</code></a>.</p></li><li><p><strong>ReactDOMFizzServer:</strong> ^[<a href=\"https://www.reddit.com/r/reactjs/comments/a495zg/react_fizz_new_streaming_server_renderer/\">“React Fizz”</a> is the codename for new server-rendering architecture, which supports streaming and suspense.] <a href=\"https://github.com/facebook/react/pull/21488\"><code>React.Suspense</code> can now be rendered on the server</a>.</p><ul><li><strong>ReactDOMServerSuspense:</strong> When rendering synchronously (e.g. <code>ReactDOMServer.renderToString</code>) this <a href=\"https://github.com/facebook/react/blob/f2a59df48bec2352a4dd3b5415282a4ea240a4f8/packages/react-dom/src/__tests__/ReactDOMServerSuspense-test.internal.js#L111\">will just render a fallback</a>.</li></ul></li><li><p><strong><a href=\"20220126T112639Z7327\">StrictEffectsMode</a>:</strong> Under the New Root API, inside <code>&lt;React.StrictMode&gt;</code>, <code>useEffect</code> and <code>useLayoutEffects</code> callbacks are <a href=\"https://github.com/facebook/react/pull/21597/files\">now</a> <a href=\"https://github.com/facebook/react/pull/19523\">doubled</a> in dev mode (<a href=\"https://github.com/facebook/react/blob/f2a59df48bec2352a4dd3b5415282a4ea240a4f8/packages/react-reconciler/src/__tests__/StrictEffectsMode-test.js#L61\">see tests</a>). That is, given the following code, it will call <code>subscribe(); unsubscribe(); subscribe()</code>:</p><pre class=\"shiki github-dark\" style=\"background-color:#252423;color:#e1e4e8;\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0;\">useEffect</span><span style=\"color:#E1E4E8;\">(() </span><span style=\"color:#F97583;\">=&gt;</span><span style=\"color:#E1E4E8;\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0;\">  subscribe</span><span style=\"color:#E1E4E8;\">()</span></span>\n<span class=\"line\"><span style=\"color:#F97583;\">  return</span><span style=\"color:#E1E4E8;\"> () </span><span style=\"color:#F97583;\">=&gt;</span><span style=\"color:#B392F0;\"> unsubscribe</span><span style=\"color:#E1E4E8;\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8;\">}, [])</span></span></code></pre></li><li><p><strong>useSyncExternalStore:</strong> <a href=\"https://github.com/reactwg/react-18/discussions/86\"><code>state = useSyncExternalStore(subscribe, get)</code></a> is introduced to allow components <a href=\"https://github.com/reactjs/rfcs/blob/main/text/0147-use-mutable-source.md\">“to safely and efficiently read from a mutable external source”</a> in a way that works with concurrent rendering. For older React versions that support hooks, <a href=\"https://www.npmjs.com/package/use-sync-external-store\"><code>use-sync-external-store/shim</code></a> package can be used. <a href=\"https://github.com/facebook/react/blob/f2a59df48bec2352a4dd3b5415282a4ea240a4f8/packages/use-sync-external-store/src/__tests__/useSyncExternalStoreShared-test.js#L127\">See tests</a>.</p></li><li><p><strong>ReactHooks:</strong> <a href=\"https://github.com/reactwg/react-18/discussions/110\"><code>useInsertionEffect</code> is for performing effects <em>before</em> <code>useLayoutEffect</code></a>, e.g. injecting style tags performantly in CSS-in-JS scenario when React is rendering concurrently.</p></li></ol>", 4)
function render(_ctx, _cache) {
  return _hoisted_1
}
__sfc__.render = render
__sfc__.__file = "Note.vue"
exports. default = __sfc__};
window.precompiledFrontMatter = {"public":true,"title":"Notes about React 18 RC.0","reddit":"https://www.reddit.com/r/reactjs/comments/scz8rs/notes_about_react_18_rc_curated_from_react_18s/","aliases":["20211212T123200Z8098"]};
</script>
  </body>
</html>

function g(n,t){var o;const e=(((o=n.ownerDocument)===null||o===void 0?void 0:o.defaultView)||window).getComputedStyle(n);return e.getPropertyValue(t)||e[t]}const w=96,T=25.4,nt=72,ot=6;function C(n){return n?g(n,"fontSize")||C(n.parentElement):g(window.document.documentElement,"fontSize")}function it(n){var t;const o=n||"0",a=parseFloat(o),e=o.match(/[\d-.]+(\w+)$/),l=(t=e==null?void 0:e[1])!==null&&t!==void 0?t:"";return[a,l.toLowerCase()]}function L(n,t){var o,a;const e=(a=(o=t==null?void 0:t.ownerDocument)===null||o===void 0?void 0:o.defaultView)!==null&&a!==void 0?a:window,l=e.document.documentElement||e.document.body,[r,d]=it(n);switch(d){case"rem":return r*L(C(window.document.documentElement));case"em":return r*L(C(t),t==null?void 0:t.parentElement);case"in":return r*w;case"q":return r*w/T/4;case"mm":return r*w/T;case"cm":return r*w*10/T;case"pt":return r*w/nt;case"pc":return r*w/ot;case"vh":return(r*e.innerHeight||l.clientWidth)/100;case"vw":return(r*e.innerWidth||l.clientHeight)/100;case"vmin":return r*Math.min(e.innerWidth||l.clientWidth,e.innerHeight||l.clientHeight)/100;case"vmax":return r*Math.max(e.innerWidth||l.clientWidth,e.innerHeight||l.clientHeight)/100;default:return r}}function I(n,t=0){let o=0,a;return Object.assign((...l)=>{const r=Math.max(0,o+t-Date.now());r?(clearTimeout(a),a=setTimeout(()=>{o=Date.now(),n(...l)},r)):(o=Date.now(),n(...l))},{cancel:()=>{o=0,clearTimeout(a)}})}function h(n,t){n.classList.add(t)}function v(n,t){n.classList.remove(t)}function M(n){var t;(t=n.parentNode)===null||t===void 0||t.removeChild(n)}const G="littlefoot__tooltip",z="is-";function j(n){const t=n.offsetHeight,o=n.getBoundingClientRect().top+t/2;return{above:o,below:window.innerHeight-o}}function _(n){const t=parseFloat(g(n,"marginLeft")),o=n.offsetWidth-t;return(n.getBoundingClientRect().left+o/2)/window.innerWidth}function k(n,t){const o=2*parseInt(g(n,"marginTop"),10)+n.offsetHeight;return t.below<o&&t.below<t.above?"above":"below"}const y="is-active",b="is-changing",N="is-scrollable",$=n=>document.body.contains(n);function rt({id:n,button:t,content:o,host:a,popover:e,wrapper:l}){let r=!1,d=0,m="above";return{id:n,activate:s=>{var u;t.setAttribute("aria-expanded","true"),h(t,b),h(t,y),t.insertAdjacentElement("afterend",e),e.style.maxWidth=document.body.clientWidth+"px",u=o,d=Math.round(L(g(u,"maxHeight"),u)),s==null||s(e,t)},dismiss:s=>{t.setAttribute("aria-expanded","false"),h(t,b),v(t,y),v(e,y),s==null||s(e,t)},isActive:()=>t.classList.contains(y),isReady:()=>!t.classList.contains(b),isHovered:()=>r,ready:()=>{h(e,y),v(t,b)},remove:()=>{M(e),v(t,b)},reposition:()=>{$(e)&&(o.style.maxHeight=function(s,u,i){const c=j(u),f=k(s,c),p=parseInt(g(s,"marginTop"),10);return Math.min(i,c[f]-p-15)}(e,t,d)+"px",m=function(s,u,i){const c=k(s,j(u));if(i!==c){v(s,z+i),h(s,z+c);const f=100*_(u)+"%",p=c==="above"?"100%":"0";s.style.transformOrigin=f+" "+p}return c}(e,t,m),e.offsetHeight<o.scrollHeight?(h(e,N),o.setAttribute("tabindex","0")):(v(e,N),o.removeAttribute("tabindex")))},resize:()=>{$(e)&&(e.style.left=function(s,u){const i=s.offsetWidth;return-_(u)*i+parseInt(g(u,"marginLeft"),10)+u.offsetWidth/2}(o,t)+"px",l.style.maxWidth=o.offsetWidth+"px",function(s,u){const i=s.querySelector("."+G);i&&(i.style.left=100*_(u)+"%")}(e,t))},startHovering:()=>{r=!0},stopHovering:()=>{r=!1},destroy:()=>M(a)}}const st=16,F="is-fully-scrolled",ct=n=>t=>{const o=t.currentTarget,a=-t.deltaY;a>0&&v(n,F),o&&a<=0&&a<o.clientHeight+o.scrollTop-o.scrollHeight&&h(n,F)},J="littlefoot__content",K="littlefoot__wrapper",D="littlefoot--print",lt="littlefoot",Q=(...n)=>n.forEach(t=>h(t,D));function A(n,t){return Array.from(n.querySelectorAll(t))}function q(n,t){return n.querySelector("."+t)||n.firstElementChild||n}function O(n){const t=document.createElement("div");t.innerHTML=n;const o=t.firstElementChild;return o.remove(),o}function at(n){return n!==void 0}function Z(n){const t=n.parentElement,o=function(e,l){return Array.from(e.children).filter(r=>r.nodeType!==8&&r.matches(l))}(t,":not(."+D+")"),a=o.filter(e=>e.tagName==="HR");o.length===a.length&&(Q(...a.concat(t)),Z(t))}function tt(n,t){const o=n.parentElement;M(n),o!==t&&(o.innerHTML.replace("[]","").replace("&nbsp;"," ").trim()||tt(o,t))}function ut([n,t,o],a){const e=O(o.outerHTML);A(e,'[href$="#'+n+'"]').forEach(r=>tt(r,e));const l=e.innerHTML.trim();return[t,o,{id:String(a+1),number:a+1,reference:"lf-"+n,content:l.startsWith("<")?l:"<p>"+l+"</p>"}]}function B(n){return t=>n.replace(/<%=?\s*(\w+?)\s*%>/g,(o,a)=>{var e;return String((e=t[a])!==null&&e!==void 0?e:"")})}function dt(n,t){const o=B(n),a=B(t);return([e,l])=>{const r=l.id,d=O(`<span class="${lt}">${o(l)}</span>`),m=d.firstElementChild;m.setAttribute("aria-expanded","false"),m.dataset.footnoteButton="",m.dataset.footnoteId=r;const s=O(a(l));s.dataset.footnotePopover="",s.dataset.footnoteId=r;const u=q(s,K),i=q(s,J);return function(c,f){c.addEventListener("wheel",I(ct(f),st))}(i,s),e.insertAdjacentElement("beforebegin",d),{id:r,button:m,host:d,popover:s,content:i,wrapper:u}}}function ft({allowDuplicates:n,anchorParentSelector:t,anchorPattern:o,buttonTemplate:a,contentTemplate:e,footnoteSelector:l,numberResetSelector:r,scope:d}){const m=function(s,u,i){return A(s,i+' a[href*="#"]').filter(c=>(c.href+c.rel).match(u))}(document,o,d).map(function(s,u,i,c){const f=[];return p=>{const H=p.href.split("#")[1],P=A(s,"#"+window.CSS.escape(H)).find(S=>u||!f.includes(S)),x=P==null?void 0:P.closest(c);if(x){f.push(x);const S=p.closest(i)||p;return[S.id||p.id,S,x]}}}(document,n,t,l)).filter(at).map(ut).map(r?function(s){let u=0,i=null;return([c,f,p])=>{const H=c.closest(s);return u=i===H?u+1:1,i=H,[c,f,Object.assign(Object.assign({},p),{number:u})]}}(r):s=>s).map(([s,u,i])=>(Q(s,u),Z(u),[s,i])).map(dt(a,e)).map(rt);return{footnotes:m,unmount(){m.forEach(s=>s.destroy()),A(document,"."+D).forEach(s=>v(s,D))}}}const mt={activateDelay:100,activateOnHover:!1,allowDuplicates:!0,allowMultiple:!1,anchorParentSelector:"sup",anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,dismissDelay:100,dismissOnUnhover:!1,dismissOnDocumentTouch:!0,footnoteSelector:"li",hoverDelay:250,numberResetSelector:"",scope:"",contentTemplate:`<aside class="littlefoot__popover" id="fncontent:<% id %>"><div class="${K}"><div class="${J}"><% content %></div></div><div class="${G}"></div></aside>`,buttonTemplate:'<button class="littlefoot__button" id="<% reference %>" title="See Footnote <% number %>"><svg role="img" aria-labelledby="title-<% reference %>" viewbox="0 0 31 6" preserveAspectRatio="xMidYMid"><title id="title-<% reference %>">Footnote <% number %></title><circle r="3" cx="3" cy="3" fill="white"></circle><circle r="3" cx="15" cy="3" fill="white"></circle><circle r="3" cx="27" cy="3" fill="white"></circle></svg></button>'},U=16,pt="[data-footnote-button]",W="[data-footnote-id]",ht="[data-footnote-popover]",R=(n,t)=>n.target.closest(t),et=n=>n==null?void 0:n.dataset.footnoteId,V=n=>t=>{t.preventDefault();const o=R(t,W),a=et(o);a&&n(a)},E=document.addEventListener,Y=window.addEventListener,X=(n,t,o,a)=>E(n,e=>{const l=e.target;l!=null&&l.closest(t)&&o.call(l,e)},a);function vt(n={}){const t=Object.assign(Object.assign({},mt),n),o=function({footnotes:e,unmount:l},r){const d=i=>c=>{c.isReady()&&(c.dismiss(r.dismissCallback),setTimeout(c.remove,i))},m=i=>c=>{r.allowMultiple||e.filter(f=>f.id!==c.id).forEach(d(r.dismissDelay)),c.isReady()&&(c.activate(r.activateCallback),c.reposition(),c.resize(),setTimeout(c.ready,i))},s=i=>c=>{const f=e.find(p=>p.id===c);f&&i(f)},u=()=>e.forEach(d(r.dismissDelay));return{activate:(i,c)=>s(m(c))(i),dismiss:(i,c)=>s(d(c))(i),dismissAll:u,touchOutside:()=>{r.dismissOnDocumentTouch&&u()},repositionAll:()=>e.forEach(i=>i.reposition()),resizeAll:()=>e.forEach(i=>i.resize()),toggle:s(i=>i.isActive()?d(r.dismissDelay)(i):m(r.activateDelay)(i)),hover:s(i=>{i.startHovering(),r.activateOnHover&&!i.isActive()&&m(r.hoverDelay)(i)}),unhover:s(i=>{i.stopHovering(),r.dismissOnUnhover&&setTimeout(()=>e.filter(c=>!c.isHovered()).forEach(d(r.dismissDelay)),r.hoverDelay)}),unmount:l}}(ft(t),t),a=function(e){const l=c=>{const f=R(c,pt),p=et(f);p?(c.preventDefault(),e.toggle(p)):R(c,ht)||e.touchOutside()},r=I(e.repositionAll,U),d=I(e.resizeAll,U),m=V(e.hover),s=V(e.unhover),u=new AbortController,i={signal:u.signal};return E("touchend",l,i),E("click",l,i),E("keyup",c=>{c.keyCode!==27&&c.key!=="Escape"&&c.key!=="Esc"||e.dismissAll()},i),E("gestureend",r,i),Y("scroll",r,i),Y("resize",d,i),X("mouseover",W,m,i),X("mouseout",W,s,i),()=>{u.abort()}}(o);return{activate(e,l=t.activateDelay){o.activate(e,l)},dismiss(e,l=t.dismissDelay){e===void 0?o.dismissAll():o.dismiss(e,l)},unmount(){a(),o.unmount()},getSetting:e=>t[e],updateSetting(e,l){t[e]=l}}}export{vt as default,vt as littlefoot};
